# Лекция 1: Стеки 

> :warning: **Для более удобного взаимодействия используйте `index.html` локально**

К сожалению, GitHub не обрабатывает Markdown и HTML в полном объеме, как хотелось бы.


| timecode                                                       | title                                        |
|:--------------------------------------------------------------:|----------------------------------------------|
| [07:28](https://youtu.be/ZUpImO_2hmA?t=448)                    | 01 Что такое стек                            |
| [12:06](https://youtu.be/ZUpImO_2hmA?t=726)                    |  02 Скобочные последовательности             |
| [24:06](https://youtu.be/ZUpImO_2hmA?t=1445)                   | 03 Вычисление выражений                      |
| [49:08](https://youtu.be/ZUpImO_2hmA?t=2952)                   | 04 Ближайшее меньшее справа (слева)          |
| [1:03:27](https://www.youtube.com/watch?v=ZUpImO_2hmA&t=3807)  |  05 Функции, рекурсия и избавление от неё    |
| [1:39:30](https://www.youtube.com/watch?v=ZUpImO_2hmA&t=5970)  | Трансляция завершена                         |



## 00. Введение

`@gettestfromcontestbot` — бот для получения тестов (входных / выходных данных) из контеста. Задержка ответов 30 минут. 


## 01. Что такое стек

> [!Note]
> Последний пришел ---> Первый вышел\
> Last In ---> Last out (или реже FILO)

В простейшем виде стек поддерживает:  

- `push(x)` --- Добавить элемент
- `pop()` --- Удалить последний с вершины стека

> [!Example] Пример
>- стопка книг (кладем наверх, убираем сверху). Доставать из центра не принято.
>- колодец

> [!tip] [09:16](https://youtu.be/ZUpImO_2hmA?t=555) Разбор примера стека


## 02. Скобочные последовательности

### Скобочные последовательности

>[!Note] Правильная скобочная последовательность (ПСП).

Правильная скобочная последовательность:
$$ S ::= \emptyset | (S) | S_1S_2 $$

>[!Example] Пример
>- Правильные: `()`, `(())`, `()(()())`
>- Неправильные: `((`, `)(`, `())()(`

  
Правильная скобочная с несколькими видами скобок:
$$ S ::= \emptyset | (S) | [S] | {S} | S_1S_2 $$

>[!Example] Пример
> - Правильные: `[]`, `{[]()}`, `[]{}()`
> - Неправильные: `[}`, `{(})`, `{[](})`


### Подсчет баланса для одного вида скобок

>[!Summary] Общая мысль
>Не должны закрываться неоткрытые скобки, в конце все открытые скобки должны быть закрыты.

Скобочная последовательность определяется через баланс открытых/закрытых скобок:

- открывается: `баланс + 1`
- закрывается: `баланс - 1`
- Баланс `>= 0` и в конце `= 0`


> [!hint] [15:56](https://youtu.be/ZUpImO_2hmA?t=956) пример подсчета баланса для одного вида скобок


### Подсчет баланса для нескольких видов скобок
  
>[!Note]
>Идея подсчета баланса для нескольких видов скобок не работает.

Тут и потребуется стек:

- Открывающиеся скобки кладем в стек
- Встретили закрывающую — проверили, **чтобы стек не пуст**, на вершине стека лежит соответствующая открывающая —> убрали ее
- В конце стек должен оказаться пустым (все открытые закрылись)


> [!hint] [20:02](https://youtu.be/ZUpImO_2hmA?t=1202)  пример использования стека

> [!Example] Примеры использования ПСП
> XML, html...
  

## 03. Вычисление выражений

### Как считать арифметические выражения

- Ищем самые глубоко вложенные скобки (возможно, с использованием баланса)
- Внутри самых вложенных скобок выполняем операции по убыванию приоритета и заменяем два операнда и операцию на одно число
- Когда внутри скобок осталось одно число — убираем скобки и начинаем сначала


### Инфиксная и постфиксная записи

> [!NOTE] Инфиксная запись (операция между операндами)
> $$6 + 3 * (1 + 4 * 5) * 2$$

> [!NOTE] Постфиксная запись (сначала операнды, потом операции)
> $$6 3 1 4 5 * + * 2 * +*$$


### Постфиксная запись

- Нет скобок
- ==Можно считать за один проход==: операнды складываем в стек, а как только встречается операция — берем два верхних операнда из стека, выполняем операцию и кладем результат в стек

> [!hint] [30:48](https://youtu.be/ZUpImO_2hmA?t=1849) пример работы постфиксной записи
  

### Преобразование инфиксконой записи в постфиксную  

- Операнд сразу попадает в ответ
- Операция выталкивает в ответ все операции с больше либо равным приоритетом и кладется в стек
- Открывающая скобка кладется в стек
- Закрывающая скобка выталкивает в ответ все операции до открывающей скобки, затем удаляет открывающую скобку
- В конце все операции записываются в ответ
  
> [!hint] [35:14](https://youtu.be/ZUpImO_2hmA?t=2114) пример преобразования инфиксной записи в постфиксную. 

> [!info]
> Можно расширить инфиксную запись другими операциями. К примеру: степень `**`, унарные операции (`-`, `sin`, `cos`) и тд.
  

## 04. Поиск ближайшего меньшего справа

### Поиск

- Для каждого числа определить индекс ближайшего меньшего числа, которое находится правее текущего.
- Очевидное решение $O(N2)$ с помощью сбалансированных двоичных деревьев поиска можно решить за $O(NlogN)$
- Хотим решение за $O(N)$
  

### Идея решения O(N)

- Будем хранить в стеке пары из значения и индекса элементов, для которых ответ еще не найден.
- Пойдем по последовательности слева-направо.
- Очередной элемент выталкивает из стека все элементы с большим значением — для них он является ответом. После этого ложится в стек сам.
- Таким образом, стек всегда будет хранить возрастающую последовательность.

> [!hint] [52:56](https://youtu.be/ZUpImO_2hmA?t=3176) пример алгоритма поиска ближайшего меньшего справа.


## 05. Рекурсия и избавление от нее
 
### Как запускаются функции

- При каждом запуске функции в стеке выделяется память под локальные переменные и параметры. Там же запоминается откуда продолжить выполнение программы после окончания работы функции
- Когда функция заканчивается — её переменные и параметры удаляются из стека, а выполнение продолжается с запомненного места

> [!hint] [1:05:58](https://youtu.be/ZUpImO_2hmA?t=3958) пример работы рекурсивной функции


### Общие правила замены рекурсии стеком

- Это нужно делать только если у языка есть ограничения или нужна неасимтотическая оптимизация
- Делаем цикл «пока стек не пуст» и делаем всю работу руками

Вообще, запуск функции --- медленная операция (выделить память, куда-то что-то скопировать, запомнить точку возврата и тд). При замене рекурсии асимптотику мы не изменим, но константу уменьшим незначительно.

> [!hint] [1:15:58](https://youtu.be/ZUpImO_2hmA?t=4558) пример решения с ручной реализацией стека
